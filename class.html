<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <title>Document</title>
</head>
<body>
    <nav class="navbar position-sticky top-0">
        <a href="#" class="navbar-brand">Logo</a>
        <ul class="nav">
            <li class="nav-item">
                <a href="#" class="nav-link">Category</a>
            </li>
            <li class="nav-item">
                <button class="position-relative">
                    <button class="position-absolute top-0 end-0 text-danger" id="cart-count"></button>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cart-check-fill" viewBox="0 0 16 16">
                        <path d="M.5 1a.5.5 0 0 0 0 1h1.11l.401 1.607 1.498 7.985A.5.5 0 0 0 4 12h1a2 2 0 1 0 0 4 2 2 0 0 0 0-4h7a2 2 0 1 0 0 4 2 2 0 0 0 0-4h1a.5.5 0 0 0 .491-.408l1.5-8A.5.5 0 0 0 14.5 3H2.89l-.405-1.621A.5.5 0 0 0 2 1H.5zM6 14a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm7 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm-1.646-7.646-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L8 8.293l2.646-2.647a.5.5 0 0 1 .708.708z"/>
                      </svg>
                </button>
            </li>
        </ul>
    </nav>
    <main class="row justify-content-center" id="dispGoods">

    </main>
</body>
</html>

<script>
    let myGoods;
    let url = "https://dummyjson.com/products";
    let dispGoods = document.getElementById("dispGoods")
    async function fetchGoods(){
        let goods = await fetch(url);
        let res = await goods.json();
        localStorage.setItem("goods", JSON.stringify(res.products))
    }
    fetchGoods();

    myGoods = JSON.parse(localStorage.getItem("goods"));
    let myCart = JSON.parse(localStorage.getItem("cart")) || [];
    console.log(myCart);

    async function displayGoods(){
        let resp = await myGoods.forEach((el, index)=>{
        let errmm = myCart.some(ssmm => ssmm.id == el.id);
        dispGoods.innerHTML += `
                <div class=' col-md-3 m-1 card shadow w-25'>
                    <img src=${el.thumbnail} w-75 />
                    <p>${el.description}</p>
                    <button onclick="addToCart(event,${el.id})" class='btn btn-warning'>${errmm? "Remove from Cart": "Add to Cart"}</button>
                </div>
            `
        })
    }
    displayGoods();

    function addToCart(ev, id){
        let found = myGoods.find(el=> el.id == id)
        console.log(found);
        console.log(myCart);
        let errmm = myCart.some(ssmm => ssmm.id == found.id);
        console.log(errmm);
        if(errmm){
            ev.target.innerHTML = "Not there... Add";
            let myIndex = myCart.indexOf(found)
            console.log(myIndex);
            myCart.splice(myIndex,1)
            localStorage.setItem("cart", JSON.stringify(myCart));
            cartCount();
            return;
        }else{
            ev.target.innerHTML = "Already there... Remove"
            myCart.push(found);
            localStorage.setItem("cart", JSON.stringify(myCart));
            cartCount();
        }
        console.log(myCart);
        displayGoods();
    }

    function cartCount(){
        document.getElementById("cart-count").innerHTML = myCart.length;
    }
    cartCount();
    
    function showOne(id){
        localStorage.setItem("oneItem", id);
        window.location.href = "oneProd.html"
    }
</script>